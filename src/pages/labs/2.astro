---
import Layout from "../../layouts/Layout.astro";
import { solveILP2DTrace } from "../../algorithms/ilp2d";

const { result, steps, feasible } = solveILP2DTrace(
  3, 2,
  3, 7, 21,
  1, 1, 14,
  { x1: [0, 4], x2: [0, 3] }
);
---

<Layout title="Лабораторная 2 — Ветви и границы">
  <section class="mb-6">
    <h1 class="text-2xl font-semibold">Лабораторная 2. Метод ветвей и границ</h1>
    <p class="mt-2 text-muted">max(3x₁ + 2x₂) при условиях: 3x₁+7x₂ ≤ 21; x₁+x₂ ≤ 14; 0≤x₁≤4; 0≤x₂≤3; x₁,x₂∈ℤ</p>
  </section>

  <div class="card p-4">
    <h2 class="font-medium mb-2">Решение</h2>
    <p>Оптимум: <span class="text-accent">{result.value}</span></p>
    <p>При x₁ = <code class="text-accent">{result.x1}</code>, x₂ = <code class="text-accent">{result.x2}</code></p>
  </div>

  <div class="card p-4 mt-6 overflow-auto">
    <h3 class="font-medium mb-3">Ход ветвления по x₁</h3>
    <table class="w-full text-sm">
      <thead class="text-muted">
        <tr>
          <th class="text-left py-1">x₁</th>
          <th class="text-left py-1">x₂ (релакс верх.)</th>
          <th class="text-left py-1">Верхняя оценка</th>
          <th class="text-left py-1">Кандидаты x₂</th>
          <th class="text-left py-1">Лучшее после шага</th>
        </tr>
      </thead>
      <tbody>
        {steps.map((s) => (
          <tr>
            <td class="py-1">{s.x1}</td>
            <td class="py-1">{Number.isFinite(s.x2RelaxUpper) ? s.x2RelaxUpper.toFixed(2) : '—'}</td>
            <td class="py-1">{Number.isFinite(s.ub) ? s.ub.toFixed(2) : '—'}</td>
            <td class="py-1">
              {s.candidates.length === 0 ? '—' : (
                <span>
                  {s.candidates.map(c => c.feasible ? `${c.x2} (f=${c.value})` : `${c.x2} (×)`).join(', ')}
                </span>
              )}
            </td>
            <td class="py-1">{s.bestAfter ? `x₁=${s.bestAfter.x1}, x₂=${s.bestAfter.x2}, f=${s.bestAfter.value}` : '—'}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <div class="card p-4 mt-6 overflow-auto">
    <h3 class="font-medium mb-3">Все допустимые решения (по убыванию цели)</h3>
    <table class="w-full text-sm">
      <thead class="text-muted">
        <tr>
          <th class="text-left py-1">#</th>
          <th class="text-left py-1">x₁</th>
          <th class="text-left py-1">x₂</th>
          <th class="text-left py-1">f = 3x₁ + 2x₂</th>
        </tr>
      </thead>
      <tbody>
        {feasible.map((r, idx) => (
          <tr>
            <td class="py-1">{idx + 1}</td>
            <td class="py-1">{r.x1}</td>
            <td class="py-1">{r.x2}</td>
            <td class="py-1">{r.value}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</Layout>

